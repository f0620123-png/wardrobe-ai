<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#9B7CFF" />
  <title>MIX & MATCH · Wardrobe AI</title>

  <link rel="manifest" href="./manifest.webmanifest?v=5" />
  <link rel="icon" href="./icon-192.png" />
  <link rel="apple-touch-icon" href="./icon-192.png" />

  <link rel="stylesheet" href="./style.css?v=5" />
</head>

<body>
  <div class="app">
    <!-- Top bar -->
    <header class="topbar">
      <div class="brand">
        <div class="logo">M</div>
        <div class="brandText">
          <div class="brandName">MIX & MATCH</div>
          <div class="brandSub">衣櫃 × 天氣 × 自選穿搭</div>
        </div>
      </div>

      <button id="btnLocate" class="btn btn-ghost" type="button">定位/更新天氣</button>
    </header>

    <!-- Weather panel -->
    <section class="panel" id="weatherPanel">
      <div id="weatherSkeleton" class="skeleton" style="display:none;">
        <div class="skeletonRow"></div>
        <div class="skeletonRow"></div>
      </div>

      <div class="weatherRow">
        <div class="weatherMain">
          <div class="temp" id="tempText">—</div>
          <div class="feels" id="feelsText">體感 —</div>
          <div class="meta" id="metaText">—</div>
        </div>
        <div class="weatherActions">
          <button class="btn btn-soft" id="btnRefreshRules" type="button">重新整理建議</button>
        </div>
      </div>

      <div class="hintBox" id="outfitHint">
        <div class="hintTitle">今日建議</div>
        <div class="hintEmpty">請先定位以取得體感溫度。</div>
      </div>
    </section>

    <!-- Tabs -->
    <nav class="tabs">
      <button class="tab active" data-tab="closet" type="button">衣櫃</button>
      <button class="tab" data-tab="mix" type="button">穿搭</button>
      <button class="tab" data-tab="settings" type="button">設定</button>
    </nav>

    <!-- Pages -->
    <main class="pages">
      <!-- Closet -->
      <section class="page active" id="page-closet">
        <div class="toolbar">
          <div class="chips" id="filterChips">
            <button class="chip active" data-filter="all" type="button">全部</button>
            <button class="chip" data-filter="top" type="button">上衣</button>
            <button class="chip" data-filter="bottom" type="button">下身</button>
            <button class="chip" data-filter="outer" type="button">外套</button>
            <button class="chip" data-filter="shoes" type="button">鞋子</button>
            <button class="chip" data-filter="accessory" type="button">配件</button>
          </div>
          <div class="toolbarRight">
            <button class="btn btn-soft" id="btnSeed" type="button">建立示範資料</button>
          </div>
        </div>

        <div class="grid" id="closetGrid"></div>

        <button class="fab" id="btnAddItem" type="button" aria-label="新增單品">+</button>
      </section>

      <!-- Mix -->
      <section class="page" id="page-mix">
        <div class="mixIntro">
          <h2 class="h2">自選穿搭（合成示意圖）</h2>
          <div class="sub">先選內搭/上衣/下身/外套/鞋子/配件，系統會合成一張示意圖。</div>
        </div>

        <div class="mixGrid">
          <button class="slot" data-slot="inner" type="button">
            <div class="slotIcon">◻︎</div>
            <div class="slotText">
              <div class="slotTitle">內搭</div>
              <div class="slotValue" id="slot-inner">未選</div>
            </div>
          </button>

          <button class="slot" data-slot="top" type="button">
            <div class="slotIcon">👕</div>
            <div class="slotText">
              <div class="slotTitle">上衣</div>
              <div class="slotValue" id="slot-top">未選</div>
            </div>
          </button>

          <button class="slot" data-slot="bottom" type="button">
            <div class="slotIcon">▭</div>
            <div class="slotText">
              <div class="slotTitle">下身</div>
              <div class="slotValue" id="slot-bottom">未選</div>
            </div>
          </button>

          <button class="slot" data-slot="outer" type="button">
            <div class="slotIcon">🧥</div>
            <div class="slotText">
              <div class="slotTitle">外套</div>
              <div class="slotValue" id="slot-outer">未選</div>
            </div>
          </button>

          <button class="slot" data-slot="shoes" type="button">
            <div class="slotIcon">👟</div>
            <div class="slotText">
              <div class="slotTitle">鞋子</div>
              <div class="slotValue" id="slot-shoes">未選</div>
            </div>
          </button>

          <button class="slot" data-slot="accessory" type="button">
            <div class="slotIcon">✦</div>
            <div class="slotText">
              <div class="slotTitle">配件</div>
              <div class="slotValue" id="slot-accessory">未選</div>
            </div>
          </button>
        </div>

        <div class="composeBox">
          <div class="composeTitle">合成示意圖會出現在這裡</div>
          <div class="composeSub">提示：合成後可長按/另存圖片（iOS）</div>

          <div class="composeCanvasWrap">
            <canvas id="composeCanvas" width="900" height="1200"></canvas>
          </div>

          <div class="composeActions">
            <button class="btn btn-soft" id="btnCompose" type="button">立即合成</button>
            <button class="btn btn-ghost" id="btnClearMix" type="button">清空選擇</button>
            <button class="btn btn-primary" id="btnExport" type="button">匯出 PNG</button>
          </div>
        </div>
      </section>

      <!-- Settings -->
      <section class="page" id="page-settings">
        <div class="settings">
          <h2 class="h2">設定</h2>

          <div class="field">
            <label class="label">Worker Base</label>
            <input id="workerBase" class="input" type="text" placeholder="https://xxxxx.workers.dev" />
            <div class="hint">預設已填入你的 Worker。若你換 Worker 名稱，記得更新這裡。</div>
          </div>

          <div class="row">
            <button class="btn btn-soft" id="btnHealth" type="button">測試 /healthz</button>
            <button class="btn btn-ghost" id="btnClearCache" type="button">清除快取/重整</button>
          </div>

          <div class="box">
            <div class="boxTitle">狀態</div>
            <pre class="pre" id="healthOut">—</pre>
          </div>

          <div class="box">
            <div class="boxTitle">提示</div>
            <div class="boxBody">
              若更新後畫面怪怪的，建議按「清除快取/重整」，或在網址加上 <code>?update=1</code> 再開一次。
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- Item modal -->
  <div class="modal" id="itemModal" aria-hidden="true">
    <div class="modalMask" data-close="1"></div>
    <div class="modalCard">
      <div class="modalHead">
        <div class="modalTitle" id="modalTitle">新增單品</div>
        <button class="iconBtn" id="btnCloseModal" type="button" aria-label="關閉">×</button>
      </div>

      <div class="modalBody">
        <div class="preview">
          <img id="itemPreview" alt="圖片預覽" />
          <div class="previewEmpty" id="previewEmpty">尚未選擇圖片</div>
        </div>

        <div class="row">
          <label class="btn btn-soft fileBtn">
            選擇照片
            <input id="fileInput" type="file" accept="image/*" />
          </label>
          <button class="btn btn-ghost" id="btnAIAnalyze" type="button">AI 分析圖片</button>
        </div>

        <div class="field">
          <label class="label">名稱（示意）</label>
          <input id="itemName" class="input" type="text" placeholder="例如：IMG_0415 / 黑色長外套" />
        </div>

        <div class="field">
          <label class="label">分類</label>
          <div class="seg" id="catSeg">
            <button class="segBtn" data-cat="top" type="button">上衣</button>
            <button class="segBtn" data-cat="bottom" type="button">下身</button>
            <button class="segBtn" data-cat="outer" type="button">外套</button>
            <button class="segBtn" data-cat="shoes" type="button">鞋子</button>
            <button class="segBtn" data-cat="accessory" type="button">配件</button>
          </div>
        </div>

        <div class="field">
          <label class="label">備註</label>
          <textarea id="itemNote" class="textarea" rows="3" placeholder="示意：材質/顏色/版型/長度/場合/季節…"></textarea>
        </div>

        <div class="box" id="aiBox" style="display:none;">
          <div class="boxTitle">AI 判斷（可編輯）</div>
          <div class="boxBody" id="aiOut"></div>
        </div>
      </div>

      <div class="modalFoot">
        <button class="btn btn-primary" id="btnSaveItem" type="button">儲存</button>
        <button class="btn btn-danger" id="btnDeleteItem" type="button" style="display:none;">刪除</button>
      </div>
    </div>
  </div>

  <!-- Picker modal -->
  <div class="modal" id="pickModal" aria-hidden="true">
    <div class="modalMask" data-close="1"></div>
    <div class="modalCard">
      <div class="modalHead">
        <div class="modalTitle" id="pickTitle">選擇</div>
        <button class="iconBtn" id="btnClosePick" type="button" aria-label="關閉">×</button>
      </div>
      <div class="modalBody">
        <div class="grid" id="pickGrid"></div>
      </div>
    </div>
  </div>

  <div id="toast" class="toast"></div>

  <script src="./db.js?v=5"></script>
  <script src="./app.js?v=5"></script>
</body>
</html>