<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#7c4dff" />
  <title>Mix & Match｜衣櫃穿搭</title>
  <link rel="manifest" href="./manifest.webmanifest" />
  <link rel="stylesheet" href="./style.css" />
</head>

<body>
  <header class="topbar">
    <div class="brand">
      <div class="logo">M</div>
      <div>
        <div class="brandTitle">MIX & MATCH</div>
        <div class="brandSub">衣櫃 × 天氣 × 自選穿搭</div>
      </div>
    </div>
    <button id="btnInstall" class="btn ghost" style="display:none;">安裝</button>
  </header>

  <main class="container">
    <!-- ============= 衣櫃 ============= -->
    <section id="viewWardrobe" class="view active">
      <div class="panel">
        <div class="panelTitle">衣櫃</div>
        <div class="panelBody">
          <div class="segRow">
            <div class="seg">
              <button class="segBtn active" data-filter="all">全部</button>
              <button class="segBtn" data-filter="top">上衣</button>
              <button class="segBtn" data-filter="bottom">下身</button>
              <button class="segBtn" data-filter="outer">外套</button>
              <button class="segBtn" data-filter="shoes">鞋子</button>
              <button class="segBtn" data-filter="accessory">配件</button>
            </div>
          </div>

          <div id="emptyWardrobe" class="empty">
            <div class="emptyTitle">你的衣櫃還是空的</div>
            <div class="emptySub">點右下角 + 新增第一件單品</div>
          </div>

          <div id="gridWardrobe" class="grid"></div>
        </div>
      </div>

      <button id="fabAdd" class="fab" aria-label="新增單品">+</button>
    </section>

    <!-- ============= 穿搭 ============= -->
    <section id="viewMix" class="view">
      <div class="panel">
        <div class="panelTitle">今日體感 × 推薦</div>
        <div class="panelBody">
          <div class="weatherCard">
            <div class="weatherLeft">
              <div id="tempText" class="temp">--°C</div>
              <div id="feelsText" class="meta">體感 --°C</div>
              <div id="metaText" class="meta">風 -- m/s · 降雨 -- mm</div>
            </div>
            <div class="weatherRight">
              <button id="btnLocate" class="btn primary">定位/更新天氣</button>
              <div id="weatherSkeleton" class="skeleton" style="display:none;">
                <div class="skLine"></div>
                <div class="skLine"></div>
              </div>
            </div>
          </div>

          <div id="outfitHint" class="hint"></div>
        </div>
      </div>

      <div class="panel">
        <div class="panelTitle">自選穿搭（合成示意圖）</div>
        <div class="panelBody">
          <div class="slots">
            <button class="slot" data-slot="inner">
              <div class="slotTitle">內搭</div>
              <div id="slotInner" class="slotValue">未選</div>
            </button>
            <button class="slot" data-slot="top">
              <div class="slotTitle">上衣</div>
              <div id="slotTop" class="slotValue">未選</div>
            </button>
            <button class="slot" data-slot="bottom">
              <div class="slotTitle">下身</div>
              <div id="slotBottom" class="slotValue">未選</div>
            </button>
            <button class="slot" data-slot="outer">
              <div class="slotTitle">外套</div>
              <div id="slotOuter" class="slotValue">未選</div>
            </button>
            <button class="slot" data-slot="shoes">
              <div class="slotTitle">鞋子</div>
              <div id="slotShoes" class="slotValue">未選</div>
            </button>
            <button class="slot" data-slot="accessory">
              <div class="slotTitle">配件</div>
              <div id="slotAccessory" class="slotValue">未選</div>
            </button>
          </div>

          <div class="mixActions">
            <button id="btnClearMix" class="btn ghost">清空選擇</button>
            <button id="btnCompose" class="btn primary">合成示意圖</button>
          </div>

          <div class="composeWrap">
            <canvas id="mixCanvas" width="900" height="1200" class="canvas"></canvas>
            <div class="composeHint">提示：合成後可長按畫面截圖保存（iOS 最穩）</div>
          </div>
        </div>
      </div>
    </section>

    <!-- ============= 設定 ============= -->
    <section id="viewSettings" class="view">
      <div class="panel">
        <div class="panelTitle">設定</div>
        <div class="panelBody">
          <div class="field">
            <div class="label">Worker Base</div>
            <input id="inpWorkerBase" class="input" type="url" />
            <div class="help">預設使用你的 Cloudflare Worker。一般不需改。</div>
          </div>

          <div class="field">
            <div class="label">快取</div>
            <div class="row">
              <button id="btnClearCache" class="btn ghost">清除天氣快取</button>
              <button id="btnClearDB" class="btn danger">清空衣櫃資料</button>
            </div>
            <div class="help">若你更新了程式碼但畫面怪怪的，建議清快取 + 重新整理。</div>
          </div>

          <div class="field">
            <div class="label">狀態</div>
            <pre id="preStatus" class="pre">—</pre>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Bottom Nav -->
  <nav class="bottomNav">
    <button class="navBtn active" data-nav="wardrobe">
      <span class="navIcon">👕</span>
      <span class="navText">衣櫃</span>
    </button>
    <button class="navBtn" data-nav="mix">
      <span class="navIcon">✨</span>
      <span class="navText">穿搭</span>
    </button>
    <button class="navBtn" data-nav="settings">
      <span class="navIcon">⚙️</span>
      <span class="navText">設定</span>
    </button>
  </nav>

  <!-- Item Modal -->
  <div id="modalItem" class="modal" aria-hidden="true">
    <div class="sheet">
      <div class="sheetHeader">
        <div id="modalTitle" class="sheetTitle">新增單品</div>
        <button id="btnCloseModal" class="iconBtn" aria-label="關閉">✕</button>
      </div>

      <div class="sheetBody">
        <div class="imgRow">
          <div class="imgBox">
            <img id="itemImagePreview" alt="單品圖片預覽" />
            <div id="imgPlaceholder" class="imgPlaceholder">尚未選擇圖片</div>
          </div>
          <div class="imgActions">
            <label class="btn ghost fileBtn">
              選擇圖片
              <input id="inpImage" type="file" accept="image/*" capture="environment" />
            </label>
            <button id="btnAIAnalyze" class="btn primary">AI 判斷圖片</button>
            <button id="btnAIText" class="btn ghost">AI 文字補完</button>
          </div>
        </div>

        <div class="field">
          <div class="label">名稱（示意）</div>
          <input id="inpName" class="input" type="text" placeholder="例如：IMG_0415 / 黑色長版外套" />
        </div>

        <div class="field">
          <div class="label">分類</div>
          <div class="chips">
            <button class="chip" data-cat="top">上衣</button>
            <button class="chip" data-cat="bottom">下身</button>
            <button class="chip" data-cat="outer">外套</button>
            <button class="chip" data-cat="shoes">鞋子</button>
            <button class="chip" data-cat="accessory">配件</button>
          </div>
          <div id="catText" class="help">目前：未選</div>
        </div>

        <div class="field">
          <div class="label">備註（材質/顏色/版型/長度/場合/季節…）</div>
          <textarea id="inpNote" class="textarea" rows="4" placeholder="示意：棉質、寬鬆、偏薄、日常、春秋..."></textarea>
        </div>

        <div class="field">
          <div class="label">AI 生成描述（可編輯）</div>
          <textarea id="inpAIDesc" class="textarea" rows="4" placeholder="按『AI 判斷圖片』自動生成"></textarea>
        </div>
      </div>

      <div class="sheetFooter">
        <button id="btnDelete" class="btn danger ghost" style="display:none;">刪除</button>
        <button id="btnSave" class="btn primary">儲存</button>
      </div>
    </div>
  </div>

  <!-- Picker Modal (for mix slots) -->
  <div id="modalPicker" class="modal" aria-hidden="true">
    <div class="sheet">
      <div class="sheetHeader">
        <div id="pickerTitle" class="sheetTitle">選擇單品</div>
        <button id="btnClosePicker" class="iconBtn" aria-label="關閉">✕</button>
      </div>
      <div class="sheetBody">
        <div class="row" style="justify-content:space-between;gap:10px;">
          <button id="btnPickNone" class="btn ghost">不選擇此項</button>
          <div class="help" id="pickerHint">—</div>
        </div>
        <div id="pickerGrid" class="grid" style="margin-top:12px;"></div>
      </div>
    </div>
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <script src="./db.js"></script>
  <script src="./app.js"></script>
</body>
</html>