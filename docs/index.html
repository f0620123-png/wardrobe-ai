<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#fbf6ef" />
  <title>我的衣櫃日記</title>

  <!-- GitHub Pages 專案站一定要用相對路徑 ./ -->
  <link rel="stylesheet" href="./styles.css?v=7" />

  <!-- 若你有放，會更完整；沒有也不影響主功能 -->
  <link rel="manifest" href="./manifest.webmanifest?v=7" />
  <link rel="icon" href="./icon-192.png" />
  <link rel="apple-touch-icon" href="./icon-192.png" />
</head>

<body>
  <div class="app" id="app">
    <header class="header">
      <div class="brand">MY WARDROBE</div>
      <h1>我的衣櫃日記</h1>
      <div class="sub" id="subText">今天收集了 0 件寶貝</div>
    </header>

    <nav class="chips" id="categoryChips" aria-label="分類">
      <button class="chip on" data-cat="all" type="button">全部</button>
      <button class="chip" data-cat="top" type="button">上衣</button>
      <button class="chip" data-cat="bottom" type="button">下著</button>
      <button class="chip" data-cat="inner" type="button">內搭</button>
      <button class="chip" data-cat="outer" type="button">外套</button>
      <button class="chip" data-cat="shoes" type="button">鞋子</button>
      <button class="chip" data-cat="acc" type="button">配件</button>
    </nav>

    <main>
      <div id="empty" class="empty" hidden>尚無衣物，點右下角 + 新增</div>
      <div id="grid" class="grid" aria-live="polite"></div>
    </main>
  </div>

  <!-- 底部導覽（你的 app.js 若會自建也不會衝突；保留一個穩定容器） -->
  <nav class="bottomNav" id="bottomNav" aria-label="主導覽">
    <button class="on" data-tab="wardrobe" type="button">衣櫃</button>
    <button data-tab="mix" type="button">自選</button>
    <button data-tab="sense" type="button">靈感</button>
    <button data-tab="me" type="button">個人</button>
  </nav>

  <!-- 浮動按鈕 -->
  <button class="fab" id="fabAdd" type="button" aria-label="新增">+</button>

  <!-- 主程式：同樣用 ./ 相對路徑 -->
  <script src="./db.js?v=7" defer></script>
  <script src="./app.js?v=7" defer></script>

  <!-- Service Worker：強制更新、立即接管、接管後自動刷新 -->
  <script>
    (function () {
      if (!('serviceWorker' in navigator)) return;

      window.addEventListener('load', async () => {
        try {
          const reg = await navigator.serviceWorker.register('./sw.js?v=7', { scope: './' });

          // 有新 SW 時，請它立刻跳過等待
          reg.addEventListener('updatefound', () => {
            const sw = reg.installing;
            if (!sw) return;
            sw.addEventListener('statechange', () => {
              if (sw.state === 'installed' && navigator.serviceWorker.controller) {
                if (reg.waiting) reg.waiting.postMessage({ type: 'SKIP_WAITING' });
              }
            });
          });

          // 新 SW 接管後，刷新一次讓 CSS/JS 立刻變新
          let refreshing = false;
          navigator.serviceWorker.addEventListener('controllerchange', () => {
            if (refreshing) return;
            refreshing = true;
            location.reload();
          });
        } catch (e) {
          console.warn('SW register failed:', e);
        }
      });
    })();
  </script>
</body>
</html>